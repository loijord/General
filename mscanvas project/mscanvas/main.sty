\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{main}

\RequirePackage{amssymb, amsmath, amsthm}
\RequirePackage{enumerate}
%\RequirePackage{a4wide}
%\RequirePackage[usenames]{color}
%\RequirePackage{soul}
\RequirePackage[all]{xy}
\RequirePackage{array}
\RequirePackage{tabularx}
%\RequirePackage[dvipsnames]{xcolor}
\RequirePackage{booktabs}
\RequirePackage{verbatim}  

\RequirePackage{minted}
\RequirePackage{hyperref}
\RequirePackage{framed}
\RequirePackage{tasks}
\RequirePackage[thicklines]{cancel}
\RequirePackage{fvextra} % tooltips
\RequirePackage{xstring} % ifeqcase sentence
\RequirePackage[framemethod=tikz]{mdframed} %colourful frames
\RequirePackage{tcolorbox} %special frames
\DeclareMathOperator{\tg}{tg}
\DeclareMathOperator{\ctg}{ctg}

%% Numbered objects of "theorem" style (text italicized).
%% The optional parameters indicate that all objects are numbered together, and "by section"


\swapnumbers
\newtheorem{thm}{teorema}
\newtheorem{isvada}[thm]{išvada}
\newtheorem{lema}[thm]{lema}
\newtheorem{teiginys}[thm]{teiginys}
\newtheorem{algoritmas}[thm]{algoritmas}
\newtheorem{atvejis}[thm]{atvejis}
\newtheorem{salyga}[thm]{sąlyga}
\newtheorem{hipoteze}[thm]{hipotezė}


%% Numbered objects of "non-theorem" style (text roman):

\theoremstyle{definition}
\newtheorem{dfn}{apibrėžimas}
\newtheorem{pastaba}{pastaba}
\newtheorem{ex}{pavyzdys}
\newtheorem{prob}{uždavinys}

%% An unnumbered remark and question:

\newtheorem*{xpastaba}{Pastaba}
\newtheorem*{xklausimas}{Klausimas}
\newtheorem*{sol}{Sprendimas}
%% Equations numbered by section:

%\numberwithin{equation}{section}

%%%%%%%%%%% For IMPAN journals:
\renewcommand*{\proofname}{Įrodymas}

%\frenchspacing

\setlength{\textwidth}{13,5cm}
\addtolength{\footskip}{1cm}
\addtolength{\hoffset}{1,3cm}
\addtolength{\voffset}{1cm}
%\pagestyle{plain}
%\linespread{1.5}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% Put your macros here:


\def\leq{\leqslant} \def\geq{\geqslant} \def\al{\alpha}
\def\be{\beta} \def\ga{\gamma} \def\de{\delta} \def\la{\lambda} \def\C{\mathbb C}
\def\F{\mathbb F} \def\N{\mathbb N} \def\R{\mathbb R}
\def\Q{\mathbb Q} \def\Z{\mathbb Z} \def\eps{\varepsilon}
\def\ro{\varrho}

%\def\null{\mathit{O}} %WTF? cannot use in framed env.
\def\ker{\text{Ker}\,}
\def\img{\text{Im}\; }
\def\rg{\text{ rg }}
\def\df{\text{def}\,}

\newcommand{\Qbar}{{\overline{\Q}}}
\newcommand{\id}{\mbox{$1 \hspace{-1.0mm} {\bf l}$}}


%%%%%%%%%%%%%%%%%%%%%%%%%
%My commands!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% tooltips with LaTeX (include fvextra)
%
% optimized for Adobe Reader (visible on mouse-over)
%     usage: \tooltip[<link colour>]{<link text>}[<tip box colour>]{<tip text>}
%   non-draggable version:
%     usage: \tooltip*[<link colour>]{<link text>}[<tip box colour>]{<tip text>}
%
% for Evince (visible on click, not draggable)
%   usage: \tooltip**[<link colour>]{<link text>}[<tip box colour>]{<tip text>}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\protect
\RequirePackage{xparse,pdfbase,ocgbase}
\RequirePackage{xcolor,calc}
\RequirePackage{tikzpagenodes}
\usetikzlibrary{calc}

\ExplSyntaxOn
\let\tpPdfLink\pbs_pdflink:nn
\let\tpPdfAnnot\pbs_pdfannot:nnnn\let\tpPdfLastAnn\pbs_pdflastann:
\let\tpAppendToFields\pbs_appendtofields:n
\def\tpPdfXform{\pbs_pdfxform:nnn{1}{1}}
\let\tpPdfLastXform\pbs_pdflastxform:
\ExplSyntaxOff

\makeatletter
\NewDocumentCommand{\tooltip}{ssO{blue}mO{yellow!20}m}{{%
  \leavevmode%
  \IfBooleanT{#1}{%
    \ocgbase@new@ocg{tipOCG.\thetcnt}{%
      /Print<</PrintState/OFF>>/Export<</ExportState/OFF>>%
    }{false}%
    \xdef\tpTipOcg{\ocgbase@last@ocg}%
  }%
  \tpPdfLink{%
    \IfBooleanTF{#2}{%
      /Subtype/Link/Border [0 0 0]/A <</S/SetOCGState/State [/Toggle \tpTipOcg]>>
    }{%
      /Subtype/Screen%
      \IfBooleanTF{#1}{%
        /AA<<%
          /E<</S/SetOCGState/State [/ON \tpTipOcg]>>%
          /X<</S/SetOCGState/State [/OFF \tpTipOcg]>>%
        >>%
      }{
        /AA<<%
          /E<</S/JavaScript/JS(%
            var fd=this.getField('tip.\thetcnt');%
            \IfBooleanF{#1}{%
              if(typeof(click\thetcnt)=='undefined'){%
                var click\thetcnt=false;%
                var fdor\thetcnt=fd.rect;var dragging\thetcnt=false;%
              }%
            }%
            if(fd.display==display.hidden){%
              fd.delay=true;fd.display=display.visible;fd.delay=false;%
            }%
           this.dirty=false;%
          )>>%
          /X<</S/JavaScript/JS(%
            if(!click\thetcnt&&!dragging\thetcnt){fd.display=display.hidden;}%
            if(!dragging\thetcnt){click\thetcnt=false;}%
            this.dirty=false;%
          )>>%
          /U<</S/JavaScript/JS(click\thetcnt=true;this.dirty=false;)>>%
          /PC<</S/JavaScript/JS (%
            var fd=this.getField('tip.\thetcnt');%
            try{fd.rect=fdor\thetcnt;}catch(e){}%
            fd.display=display.hidden;this.dirty=false;%
          )>>%
          /PO<</S/JavaScript/JS(this.dirty=false;)>>%
        >>%
      }
    }%
  }{{\color{#3}#4}}%
  \sbox\tiptext{\fcolorbox{black}{#5}{#6}}%
  \edef\twd{\the\wd\tiptext}%
  \edef\tht{\the\ht\tiptext}%
  \edef\tdp{\the\dp\tiptext}%
  \measureremainder{\whatsleft}\tipshift=0pt%
  \ifdim\whatsleft<\twd\setlength\tipshift{\whatsleft-\twd}\fi%
  \tpPdfXform{\tiptext}%
  \raisebox{\heightof{#4}+\tdp}[0pt][0pt]{\makebox[0pt][l]{\hspace{\tipshift}%
    \tpPdfAnnot{\twd}{\tht}{\tdp}{%
      /Subtype/Widget/FT/Btn/T (tip.\thetcnt)%
      /AP<</N \tpPdfLastXform>>%
      /MK<</TP 1/I \tpPdfLastXform/IF<</S/A/FB true/A [0.0 0.0]>>>>%
      \IfBooleanTF{#1}{%
        /Ff 65537/OC \tpTipOcg%
      }{%
        /Ff 65536/F 3%
        /AA <<%
          /U <<%
            /S/JavaScript/JS(%
              var fd=event.target;%
              var mX=this.mouseX;var mY=this.mouseY;%
              var drag=function(){%
                var nX=this.mouseX;var nY=this.mouseY;%
                var dX=nX-mX;var dY=nY-mY;%
                var fdr=fd.rect;%
                fdr[0]+=dX;fdr[1]+=dY;fdr[2]+=dX;fdr[3]+=dY;%
                fd.rect=fdr;mX=nX;mY=nY;%
              };%
              if(!dragging\thetcnt){%
                dragging\thetcnt=true;Int=app.setInterval("drag()",1);%
              }%
              else{app.clearInterval(Int);dragging\thetcnt=false;}%
              this.dirty=false;%
            )%
          >>%
        >>%
      }%
    }%
    \tpAppendToFields{\tpPdfLastAnn}%
  }}%
  \stepcounter{tcnt}%
}}
\makeatother
\newsavebox\tiptext\newcounter{tcnt}
\newlength{\whatsleft}\newlength{\tipshift}
\newcommand{\measureremainder}[1]{%
  \begin{tikzpicture}[overlay,remember picture]
    \path let \p0 = (0,0), \p1 = (current page.east) in
      [/utils/exec={\pgfmathsetlength#1{\x1-\x0}\global#1=#1}];
  \end{tikzpicture}%
}

%colors

\newcommand{\red}[1]{{\color{OrangeRed}#1}}
\newcommand{\blue}[1]{{\color{NavyBlue}#1}}
\newcommand{\green}[1]{{\color{ForestGreen}#1}}
\newcommand{\eqcolor}[1]{\bm{{\color{Plum}#1}}}

%'or' cases
\makeatletter
\newenvironment{sqcases}
{\matrix@check\sqcases\env@sqcases}
{\endarray\right.}
\def\env@sqcases{\let\@ifnextchar\new@ifnextchar
\left\lbrack
\def\arraystretch{1.2}\array{@{}l@{\quad}l@{}}}
\makeatother

%input systems$
\newcommand{\cc}[2]{\begin{cases}#1 \\ #2\end{cases}}
\newcommand{\ccc}[3]{\begin{cases}#1 \\ #2 \\ #3\end{cases}}
\newcommand{\cccc}[4]{\begin{cases}#1 \\ #2 \\ #3 \\ #4\end{cases}}
\newcommand{\ecc}[2]{\begin{sqcases}#1 \\ #2\end{sqcases}}
\newcommand{\eccc}[3]{\begin{sqcases}#1 \\ #2 \\ #3\end{sqcases}}
\newcommand{\ecccc}[4]{\begin{cases}#1 \\ #2 \\ #3 \\ #4 \end{cases}}
\newcommand{\tbf}[1]{\textbf{#1}}
\newcommand{\tit}[1]{\textit{#1}}
\newcommand{\ttt}[1]{\texttt{#1}}
\newcommand{\mbb}[1]{\mathbb{#1}}

%new updates
\newcommand{\inp}[3]{\tooltip**{#1}[Tan!60]{$\displaystyle \begin{array}{l} \text{Įvedamas žymėjimas } #2 :\\ #3 \end{array}$ }} %zymejimo ivedimo stikeris
\newcommand{\stip}[1]{\tooltip**{$\blacksquare$}{#1}} %kvadratinis stikeris
\newcommand{\ematlab}[2]{\stip{#1}\mintinline[breaklines]{matlab}{#2}} %paaiskintas matlab kodas
\newcommand{\epython}[2]{\stip{#1}\mintinline[breaklines]{python}{#2}} %paaiskintas matlab kodas

%declaring the structure of equation
\DeclareDocumentCommand{\e}{O{=} O{default} O{???} O{formulę} O{} O{}}{
\tooltip**{\ensuremath{\stackrel{\text{
\IfEqCase{#2}{{}{}}[\href{#2}{$\blue{\blacksquare}$}]}}{#1}}}
{\ensuremath{#3}\IfEqCase{#4}{{}{}}[ pagal #4 ]
\ensuremath{#5} \IfEqCase{#6}{{}{}}[, kur \ensuremath{#6}]}
}

\DeclareDocumentCommand{\E}{O{} O{} O{} O{} O{}}{
\tooltip**{\ensuremath{#1}}{
\IfEqCase{#5}{{}{
\IfEqCase{#4}{{}{
\IfEqCase{#3}{{}{pagal #2 }}[$\begin{array}{l} \text{pagal #2} \\ \ensuremath{#3} \end{array}$]}}
[$\begin{array}{l} \text{pagal #2} \\ ensuremath{#3} \\ \text{kur } \ensuremath{#4} \end{array}$]}}
[$\begin{array}{l} \text{pagal #2} \\ \ensuremath{#3} \\ \text{kur } \ensuremath{#4} \end{array}$]
}}
\endinput

